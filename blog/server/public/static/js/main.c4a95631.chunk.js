(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{15:function(e,t,n){},16:function(e,t,n){},17:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(3),s=n.n(o),i=(n(15),n(4)),c=n(5),l=n(7),u=n(6),d=n(8),h=n(1),m=function(e){var t=e.user;return r.a.createElement("div",{className:"user"},r.a.createElement("span",{className:"username"},t))},f=function(e){var t=e.users,n=Object.keys(t).map(function(e){return r.a.createElement("li",{key:e},r.a.createElement(m,{user:e}))});return r.a.createElement("ul",{className:"users"},n)},g=function(e){var t=e.blog;return r.a.createElement("div",{className:"message"},r.a.createElement("div",{className:"meta-info"},r.a.createElement("div",{className:"sender-info"},r.a.createElement("span",{className:"username"},t.sender)),r.a.createElement("div",{className:"message-info"},r.a.createElement("span",{className:"title"},t.title),r.a.createElement("span",{className:"timestamp"},t.timestamp.toString()))),r.a.createElement("div",{className:"message-text"},t.text))},b=function(e){var t=e.blogs,n=e.handleDelete,a=Object.values(t).map(function(e){return r.a.createElement("li",{key:e.id},r.a.createElement(g,{blog:e}),r.a.createElement("button",{onClick:function(){return n(e.id)}},"Delete Blog"))});return r.a.createElement("ul",{className:"blog"},a)},p=function(e){var t=e.errorinfo;return r.a.createElement("div",{className:"error"},r.a.createElement("p",{className:"error-info"},t))},v=function(e){var t=e.handleLogout;return r.a.createElement("div",{className:"logout"},r.a.createElement("button",{className:"logout-button",onClick:t},"Logout"))},E=function(){return fetch("/users/",{headers:new Headers({"content-type":"application/json"})}).catch(function(e){return Promise.reject({code:"Connection error",err:e})}).then(function(e){return e.ok?e.json():Promise.reject({code:"Wrong users",err:e.statusText})})},y=function(e){var t=e.username;return fetch("/login/",{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify({username:t})}).catch(function(e){return Promise.reject({code:"Connection error",err:e})}).then(function(e){if(!e.ok)return Promise.reject({code:"Not a valid username, please make sure you have registered and you have logout.",err:e.statusText})})},S=function(e){var t=e.username;return fetch("/logout/",{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify({username:t})}).catch(function(e){return Promise.reject({code:"Connection error",err:e})}).then(function(e){if(!e.ok)return Promise.reject({code:"Error, please try again.",err:e.statusText})})},j=function(){return fetch("/blogs/",{headers:new Headers({"content-type":"application/json"})}).catch(function(e){return Promise.reject({code:"Connection error.",err:e})}).then(function(e){return e.ok?e.json():Promise.reject({code:"Wrong blogs",err:e.statusText})})},w=function(e){var t=e.sender,n=e.title,a=e.text;return fetch("/blogs/",{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify({sender:t,title:n,text:a})}).catch(function(e){return Promise.reject({code:"Connection error.",err:e})}).then(function(e){return e.ok?e.json():Promise.reject({code:"Wrong blogs.",err:e.statusText})})},N=function(e){var t=e.newUsers;return fetch("/default-users/",{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify({newUsers:t})}).catch(function(e){return Promise.reject({code:"Connection error.",err:e})}).then(function(e){if(!e.ok)return Promise.reject({code:"This name already registered.",err:e.statusText})})},x=function(e){var t=e.id,n=e.username;return fetch("/delete-blogs/",{method:"POST",headers:new Headers({"content-type":"application/json"}),body:JSON.stringify({id:t,username:n})}).catch(function(e){return Promise.reject({code:"Connection error.",err:e})}).then(function(e){if(!e.ok)return Promise.reject({code:"You cannot delete this blog, because this blog does not exit or this blog was not post by you.",err:e.statusText})})},O=(n(16),function(e){function t(e){var n;return Object(i.a)(this,t),(n=Object(l.a)(this,Object(u.a)(t).call(this,e))).handleText=function(e){n.setState({text:e.target.value})},n.handleTitle=function(e){n.setState({title:e.target.value})},n.handleNewUser=function(e){n.setState({username:e.target.value})},n.handleNewRegistration=function(e){n.setState({newUsers:e.target.value})},n.handleRegistration=function(e){console.log(n.state.newUsers),N({newUsers:n.state.newUsers}).then(function(e){n.setState({newUsers:""})}).catch(function(e){console.log(n.state.errorinfo),n.setState({newUsers:"",errorinfo:e.code})})},n.handleLogin=function(e){console.log(n.state.username),y({username:n.state.username}).then(function(e){n.setState({loginStatus:!0}),console.log(n.state.username),console.log(n.state.loginStatus),n.refresh()}).catch(function(e){console.log(n.state.errorinfo),n.setState({errorinfo:e.code,username:""})})},n.handleLogout=function(e){S({username:n.state.username}).then(function(e){n.setState({loginStatus:!1,username:""}),n.handleUser()}).catch(function(e){n.setState({errorinfo:e.code})})},n.handleDelete=function(e){console.log(e),x({id:e,username:n.state.username}).then(function(e){n.handleBlogs()}).catch(function(e){n.setState({errorinfo:e.code})})},n.handleEnterKey=function(e){13===e.nativeEvent.keyCode&&n.handleSubmit()},n.handleSubmit=function(){n.state.text&&n.state.title&&(console.log(n.state.text),console.log(n.state.title),w({sender:n.state.username,title:n.state.title,text:n.state.text}).catch(function(e){n.setState({errorinfo:e.code,title:"",text:""})})),n.handleBlogs()},n.handleUser=function(){E().then(function(e){n.setState({users:e,errorinfo:""})}).catch(function(e){n.setState({errorinfo:e.code})})},n.handleBlogs=function(){j().then(function(e){n.setState({title:"",text:"",blogs:e,errorinfo:""})}).catch(function(e){n.setState({errorinfo:e.code})})},n.refresh=function(){n.handleUser(),n.handleBlogs()},n.refreshWithoutChangeText=function(){E().then(function(e){n.setState({users:e})}).catch(function(e){n.setState({errorinfo:e.code})}),j().then(function(e){n.setState({blogs:e})}).catch(function(e){n.setState({errorinfo:e.code})})},n.state={loginStatus:!1,username:"",title:"",text:"",users:{},newUsers:"",blogs:{},errorinfo:""},n.handleEnterKey=n.handleEnterKey.bind(Object(h.a)(Object(h.a)(n))),n.handleBlogs=n.handleBlogs.bind(Object(h.a)(Object(h.a)(n))),n.handleUser=n.handleUser.bind(Object(h.a)(Object(h.a)(n))),n.refresh=n.refresh.bind(Object(h.a)(Object(h.a)(n))),n}return Object(d.a)(t,e),Object(c.a)(t,[{key:"componentDidMount",value:function(){var e=this;this.interval=setInterval(function(){return e.refreshWithoutChangeText()},5e3)}},{key:"render",value:function(){var e=this;return this.state.loginStatus?r.a.createElement("div",{className:"chat-app"},r.a.createElement("div",{className:"display-panel"},r.a.createElement(f,{users:this.state.users}),r.a.createElement(b,{blogs:this.state.blogs,handleDelete:this.handleDelete.bind(this)})),r.a.createElement("div",{className:"outgoing"},r.a.createElement("div",null,r.a.createElement("p",null,"New blog's title:"),r.a.createElement("input",{className:"new-title",value:this.state.title,onChange:this.handleTitle.bind(this)})),r.a.createElement("div",{className:"content-text"},r.a.createElement("p",null,"New blog's content:"),r.a.createElement("input",{className:"new-content",value:this.state.text,onChange:this.handleText.bind(this),onKeyPress:this.handleEnterKey}),r.a.createElement("button",{onClick:this.handleSubmit,disabled:!this.state.text||!this.state.title},"Send"))),r.a.createElement(v,{handleLogout:this.handleLogout}),r.a.createElement(p,{errorinfo:this.state.errorinfo})):r.a.createElement("div",{className:"chat-app"},r.a.createElement("div",{className:"display-panel"},r.a.createElement("div",{className:"frame-work"},"Welcome to this public blog! Please sign up and login!"),r.a.createElement("div",{className:"input-username"},r.a.createElement("span",null,"Please input your username: "),r.a.createElement("input",{value:this.state.username,onChange:this.handleNewUser.bind(this),ref:function(t){return e.myInput=t}}),r.a.createElement("button",{onClick:this.handleLogin.bind(this),disabled:!this.state.username},"Login")),r.a.createElement("div",{className:"input-registration"},r.a.createElement("span",null,"Or free register: "),r.a.createElement("input",{value:this.state.newUsers,onChange:this.handleNewRegistration.bind(this)}),r.a.createElement("button",{onClick:this.handleRegistration.bind(this)},"Register"))),r.a.createElement(p,{errorinfo:this.state.errorinfo}))}}]),t}(a.Component));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));s.a.render(r.a.createElement(O,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},9:function(e,t,n){e.exports=n(17)}},[[9,1,2]]]);
//# sourceMappingURL=main.c4a95631.chunk.js.map